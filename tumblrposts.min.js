/*
 * TumblrPost Class 
 * @version 1.1
 * @author mach3
 * @requires jQuery, jQuery.class.js
 */
var TumblrPosts=Class.create();TumblrPosts.prototype={EVENT_COMPLETE:"complete",EVENT_PROGRESS:"progress",config:{domain:null,maxNum:0},api:"/api/read/json/",postsTotal:0,posts:[],allTags:null,tags:null,offset:0,num:50,initialize:function(a){$.extend(this.config,a);this.api=(this.config.domain)?"http://"+this.config.domain+this.api:this.api},run:function(c,a){var b=this,d=false;if(!!c){this.postsTotal=c["posts-total"];this.offset+=this.num;this.allTags=this.allTags||"";if(!c.posts.length){this.trigger(this.EVENT_COMPLETE);return}$.each(c.posts,function(e,f){if(b.config.maxNum>0&&b.posts.length>=b.config.maxNum){b.trigger(b.EVENT_COMPLETE);d=true;return false}b.posts.push(f);if(!f.tags){return}b.allTags+=","+f.tags.join(",")});if(d){return}this.trigger(this.EVENT_PROGRESS)}$.ajax({url:this.api,data:{start:this.offset,num:this.num},dataType:"jsonp",success:function(f,e){b.run(f,e)}})},getTags:function(){var b=this,a={};if(this.tags===null){this.allTags=(this.allTags.replace(/^,/,"")).split(",");$.each(this.allTags,function(d,c){a[c]=(a[c])?a[c]+1:1});this.tags=[];$.each(a,function(c,d){b.tags.push({name:c,count:d})});this.tags.sort(function(d,c){return c.count-d.count})}return this.tags},getPosts:function(c,b){var c=c||0,b=b||10,a=[];$.each(this.posts,function(d,e){if(d<c){return}if(d>c+b){return false}a.push(e)});return a},getTitleByPost:function(a,b){var c=a["regular-title"]||a["photo-caption"]||a["regular-body"]||"";c=c.replace(/\<.+?\>/gi,"");c=(b)?c.substr(0,b):c;return c},getLoadedRate:function(){return Math.floor(100*this.posts.length/Math.min(this.postsTotal,(this.config.maxNum||this.postsTotal)))}};